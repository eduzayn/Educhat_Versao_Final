Tarefa Completa: Registro Autom√°tico de Contatos com Identifica√ß√£o de Canal e Filtros Avan√ßados
üéØ Objetivo Geral
Implementar uma rotina que:

Crie automaticamente um novo contato no sistema assim que uma nova mensagem √© recebida por qualquer canal;

Evite a duplica√ß√£o de contatos usando o n√∫mero de telefone ou outro identificador √∫nico;

Registre corretamente o nome do canal e o tipo de canal no momento da cria√ß√£o do contato;

Permita filtrar contatos tanto pelo tipo de canal quanto pelo nome do canal;

Atualize retroativamente os contatos antigos com essas informa√ß√µes, quando poss√≠vel.

üìå Cen√°rio Atual
Hoje, o sistema salva contatos de forma separada por canal, e n√£o h√° um campo vis√≠vel e filtr√°vel que permita saber de onde aquele contato est√° falando (por exemplo, se √© do WhatsApp Comercial, WhatsApp Cobran√ßa, Instagram, etc.).

Al√©m disso, o contato s√≥ aparece quando √© criado manualmente ou ap√≥s alguma a√ß√£o espec√≠fica. Isso precisa ser autom√°tico e com os campos certos.

‚úÖ Requisitos Funcionais
1. Cria√ß√£o Autom√°tica de Contatos
Sempre que o sistema receber uma nova mensagem de um canal (WhatsApp, Facebook, Instagram, etc.), ele deve:

Verificar se o contato j√° existe com base no campo id_canal ou user_identity (n√∫mero ou e-mail);

Se n√£o existir, criar automaticamente um novo contato com os seguintes campos:

json
Copiar
Editar
{
  "nome": "Jo√£o da Silva",
  "telefone": "+5531988887777",
  "user_identity": "+5531988887777",
  "canal_origem": "whatsapp",
  "nome_canal": "WhatsApp Cobran√ßa",
  "id_canal": "whatsapp-2", 
  "data_criacao": "2025-06-03T22:13:00Z"
}
Observa√ß√£o: o nome_canal √© o nome que o administrador configurou para esse canal espec√≠fico, como ‚ÄúWhatsApp Comercial‚Äù ou ‚ÄúInstagram Loja‚Äù.

2. Evitar Duplica√ß√£o de Contatos
O sistema deve checar se j√° existe um contato com o mesmo user_identity ou id_canal.

Se j√° existir, n√£o criar um novo contato, apenas vincular a nova conversa ao existente.

3. Filtros Avan√ßados
A listagem de contatos (na p√°gina /contactos) deve permitir filtragem por:

canal_origem (ex: WhatsApp, Facebook, Instagram)

nome_canal (ex: WhatsApp Suporte, WhatsApp Comercial)

telefone, nome, email (j√° existentes)

4. Exibi√ß√£o de Dados na Caixa de Entrada
No painel lateral direito da caixa de entrada, onde aparece o nome do contato, tamb√©m deve aparecer:

O nome do canal (ex: ‚ÄúWhatsApp Comercial‚Äù)

E opcionalmente o tipo do canal (ex: "WhatsApp")

5. Atualiza√ß√£o Retroativa de Contatos
Criar um script de migra√ß√£o que percorra os contatos existentes e:

Preencha os campos canal_origem, nome_canal, id_canal e user_identity com base nas mensagens/conversas anteriores, se poss√≠vel.

Marque os contatos com dados inconsistentes para revis√£o manual, se necess√°rio.

üß™ Exemplo de Visualiza√ß√£o na Interface
üü¢ Na caixa de entrada (inbox):
Nome do contato: Ana Vivo Novo

N√∫mero: 553798694620

Canal: WhatsApp Suporte

Exibir:

makefile
Copiar
Editar
Ana Vivo Novo
üìû 553798694620
Canal: WhatsApp Suporte
üü¢ Na listagem de contatos (/contactos):
Nome	Telefone	Canal Origem	Nome do Canal	Criado em
Ana Vivo Novo	553798694620	WhatsApp	WhatsApp Suporte	mai. de 2025
Tony e Tchelo	553788330782	WhatsApp	WhatsApp Comercial	jun. de 2025
Luciana Queilhas	5511987742664	Instagram	Instagram Loja	mai. de 2025

üõ†Ô∏è Requisitos T√©cnicos
Banco de Dados:
Adicionar os seguintes campos na tabela de contatos:

canal_origem (string)

nome_canal (string)

id_canal (string)

user_identity (string)

Backend:
No webhook de recebimento de mensagem:

Verificar se o contato j√° existe com id_canal ou user_identity

Criar o contato automaticamente se necess√°rio

Preencher todos os campos acima

Frontend:
Exibir canal_origem e nome_canal no painel lateral da caixa de entrada

Adicionar filtros por canal_origem e nome_canal na p√°gina de contatos

Atualizar a visualiza√ß√£o da tabela para mostrar esses campos

Script de Migra√ß√£o:
Iterar sobre todos os contatos existentes

Verificar se h√° mensagens/conversas associadas

Preencher canal_origem, nome_canal e user_identity com base no hist√≥rico

‚úÖ Conclus√£o
Essa tarefa √© essencial para garantir organiza√ß√£o e rastreabilidade dos contatos no sistema, especialmente quando o mesmo cliente se comunica por diferentes canais (e n√∫meros de WhatsApp distintos, como suporte, comercial, cobran√ßa). Com essa estrutura, ser√° poss√≠vel evitar duplica√ß√µes, organizar melhor a opera√ß√£o e facilitar a visualiza√ß√£o e o atendimento omnichannel.

