âœ… Tarefa para o Replit â€“ CriaÃ§Ã£o AutomÃ¡tica de NegÃ³cios
Objetivo:
Garantir que todo novo contato criado â€” seja manualmente ou automaticamente via canais de entrada (WhatsApp, Instagram, etc.) â€” gere um novo negÃ³cio automaticamente no CRM, posicionado no primeiro estÃ¡gio do funil de vendas (ProspecÃ§Ã£o).

ğŸ§© Regras e LÃ³gica
1. Gatilhos de criaÃ§Ã£o:
A. Contato criado automaticamente via entrada de mensagem:

Quando um novo contato Ã© gerado automaticamente ao receber uma nova mensagem de um canal (ex: webhook de WhatsApp, Instagram, Telegram etc.).

Se o contato ainda nÃ£o existir no banco, o sistema:

Salva o contato normalmente;

Em seguida, cria um negÃ³cio vinculado a esse contato.

B. Contato criado manualmente pelo botÃ£o â€œNovo Contatoâ€:

Ao salvar um novo contato manualmente, o sistema deve:

Criar um negÃ³cio automaticamente para esse contato.

ğŸ—ƒï¸ Detalhes do NegÃ³cio Criado
name: usar nome do contato ou nÃºmero + sufixo â€œâ€“ Novo Leadâ€.

stage: "prospecting" (primeiro estÃ¡gio do Kanban).

value: iniciar com 0 ou null.

contactId: vincular ao ID do contato criado.

canal_origem: mesmo canal de origem do contato (WhatsApp, Instagram etc.).

tags: incluir ['lead_automÃ¡tico'] ou ['lead_manual'] dependendo do tipo de criaÃ§Ã£o.

owner: opcional â€” pode ser o usuÃ¡rio logado (para criaÃ§Ã£o manual).

created_at: data/hora da criaÃ§Ã£o.

ğŸ” Regras adicionais:
Evitar duplicaÃ§Ã£o: sÃ³ criar um novo negÃ³cio se o contato for realmente novo (nÃ£o duplicado).

O novo negÃ³cio deve aparecer automaticamente no Kanban (DealsKanbanUpdated) na coluna ProspecÃ§Ã£o.

Futuramente, quando o contato evoluir (ex: fizer matrÃ­cula), esse negÃ³cio poderÃ¡:

Ser movido para o estÃ¡gio â€œFechadoâ€;

Ter seu valor atualizado com o valor real do curso;

Ser enriquecido com mais dados (curso, origem do lead, status, observaÃ§Ãµes etc.).

ğŸ“Œ Exemplo de LÃ³gica Unificada (pseudo cÃ³digo)
ts
Copiar
Editar
function handleNewContact(contact, origemManual = false) {
  // Criar contato (automÃ¡tico ou manual)
  const novoContato = saveContact(contact);

  // Criar negÃ³cio atrelado ao contato
  createDeal({
    name: `${novoContato.name || novoContato.telefone} â€“ Novo Lead`,
    stage: 'prospecting',
    value: 0,
    contactId: novoContato.id,
    canal_origem: novoContato.canal,
    tags: [origemManual ? 'lead_manual' : 'lead_automÃ¡tico']
  });
}
