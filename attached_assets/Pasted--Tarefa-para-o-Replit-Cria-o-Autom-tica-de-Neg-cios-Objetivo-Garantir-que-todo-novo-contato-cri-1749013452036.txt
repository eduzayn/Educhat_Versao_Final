✅ Tarefa para o Replit – Criação Automática de Negócios
Objetivo:
Garantir que todo novo contato criado — seja manualmente ou automaticamente via canais de entrada (WhatsApp, Instagram, etc.) — gere um novo negócio automaticamente no CRM, posicionado no primeiro estágio do funil de vendas (Prospecção).

🧩 Regras e Lógica
1. Gatilhos de criação:
A. Contato criado automaticamente via entrada de mensagem:

Quando um novo contato é gerado automaticamente ao receber uma nova mensagem de um canal (ex: webhook de WhatsApp, Instagram, Telegram etc.).

Se o contato ainda não existir no banco, o sistema:

Salva o contato normalmente;

Em seguida, cria um negócio vinculado a esse contato.

B. Contato criado manualmente pelo botão “Novo Contato”:

Ao salvar um novo contato manualmente, o sistema deve:

Criar um negócio automaticamente para esse contato.

🗃️ Detalhes do Negócio Criado
name: usar nome do contato ou número + sufixo “– Novo Lead”.

stage: "prospecting" (primeiro estágio do Kanban).

value: iniciar com 0 ou null.

contactId: vincular ao ID do contato criado.

canal_origem: mesmo canal de origem do contato (WhatsApp, Instagram etc.).

tags: incluir ['lead_automático'] ou ['lead_manual'] dependendo do tipo de criação.

owner: opcional — pode ser o usuário logado (para criação manual).

created_at: data/hora da criação.

🔁 Regras adicionais:
Evitar duplicação: só criar um novo negócio se o contato for realmente novo (não duplicado).

O novo negócio deve aparecer automaticamente no Kanban (DealsKanbanUpdated) na coluna Prospecção.

Futuramente, quando o contato evoluir (ex: fizer matrícula), esse negócio poderá:

Ser movido para o estágio “Fechado”;

Ter seu valor atualizado com o valor real do curso;

Ser enriquecido com mais dados (curso, origem do lead, status, observações etc.).

📌 Exemplo de Lógica Unificada (pseudo código)
ts
Copiar
Editar
function handleNewContact(contact, origemManual = false) {
  // Criar contato (automático ou manual)
  const novoContato = saveContact(contact);

  // Criar negócio atrelado ao contato
  createDeal({
    name: `${novoContato.name || novoContato.telefone} – Novo Lead`,
    stage: 'prospecting',
    value: 0,
    contactId: novoContato.id,
    canal_origem: novoContato.canal,
    tags: [origemManual ? 'lead_manual' : 'lead_automático']
  });
}
