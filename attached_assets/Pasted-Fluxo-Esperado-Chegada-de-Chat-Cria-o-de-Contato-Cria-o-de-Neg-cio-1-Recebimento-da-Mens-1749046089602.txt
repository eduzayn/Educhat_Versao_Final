Fluxo Esperado – Chegada de Chat + Criação de Contato + Criação de Negócio
1. 📥 Recebimento da Mensagem
O sistema recebe uma nova mensagem vinda de um canal externo (ex: WhatsApp, Instagram, Telegram, etc.) via webhook, API ou socket.

2. 🔍 Verificação de Contato Existente
O sistema verifica se já existe um contato com base em:

user_identity (ex: número de telefone, ID do canal, etc.)

Ou combinação de canal_origem + telefone

Se o contato já existir:

A mensagem é vinculada à conversa existente.

Nenhuma ação adicional é necessária nesta etapa.

Se o contato NÃO existir:

Criar um novo contato automaticamente com os seguintes dados:

nome (se não houver, usar “Novo contato” + telefone)

telefone ou user_identity

canal_origem (ex: WhatsApp)

nome_canal (ex: WhatsApp Comercial)

tags iniciais (ex: ['lead_automático'])

criado_em: data/hora atual

3. 📊 Criação de um Novo Negócio no CRM
Assim que o novo contato for salvo com sucesso, o sistema deve criar automaticamente um novo negócio (deal) com os seguintes dados:

name: mesmo nome do contato ou número

stage: "prospecting" (primeiro estágio do funil)

macrosetor: deve ser identificado com base no canal de origem:

Ex: WhatsApp Comercial → comercial

WhatsApp Suporte → suporte

WhatsApp Cobrança → cobranca

contactId: ID do novo contato

value: 0 (ou null)

tags: incluir ['lead_automático']

canal_origem: herdado do contato

created_at: timestamp atual

4. 🔄 Associação com o funil correto
O negócio deve aparecer no funil correspondente ao macrosetor (comercial, suporte ou cobrança).

Exemplo: se o canal for “WhatsApp Suporte”, o negócio deve ser exibido automaticamente na primeira etapa do funil do suporte.

5. 🧭 Exibição imediata na interface
O negócio criado deve aparecer no Kanban (DealsKanban) no setor correto.

O contato deve aparecer na página de contatos com o campo canal_origem e link para o negócio.

A conversa deve ser roteada para a caixa de entrada corretamente.

📌 Pergunta que você pode enviar ao Replit
Por favor, verifiquem se o seguinte fluxo está funcionando corretamente no sistema:

Quando uma nova mensagem chega por um canal (WhatsApp, Instagram, etc.), o sistema deve:

Criar automaticamente um novo contato (se não existir);

Criar automaticamente um novo negócio no CRM;

Posicionar esse negócio no funil correto com base no canal (comercial, suporte ou cobrança);

Exibir esse negócio no Kanban, etapa “Prospecção” do setor correspondente;

Exibir o contato na listagem com canal de origem, tags e vínculo com o negócio.

Isso está implementado e funcionando como descrito? Caso não, gostaria de entender onde está o ponto de falha.