Fluxo Esperado â€“ Chegada de Chat + CriaÃ§Ã£o de Contato + CriaÃ§Ã£o de NegÃ³cio
1. ğŸ“¥ Recebimento da Mensagem
O sistema recebe uma nova mensagem vinda de um canal externo (ex: WhatsApp, Instagram, Telegram, etc.) via webhook, API ou socket.

2. ğŸ” VerificaÃ§Ã£o de Contato Existente
O sistema verifica se jÃ¡ existe um contato com base em:

user_identity (ex: nÃºmero de telefone, ID do canal, etc.)

Ou combinaÃ§Ã£o de canal_origem + telefone

Se o contato jÃ¡ existir:

A mensagem Ã© vinculada Ã  conversa existente.

Nenhuma aÃ§Ã£o adicional Ã© necessÃ¡ria nesta etapa.

Se o contato NÃƒO existir:

Criar um novo contato automaticamente com os seguintes dados:

nome (se nÃ£o houver, usar â€œNovo contatoâ€ + telefone)

telefone ou user_identity

canal_origem (ex: WhatsApp)

nome_canal (ex: WhatsApp Comercial)

tags iniciais (ex: ['lead_automÃ¡tico'])

criado_em: data/hora atual

3. ğŸ“Š CriaÃ§Ã£o de um Novo NegÃ³cio no CRM
Assim que o novo contato for salvo com sucesso, o sistema deve criar automaticamente um novo negÃ³cio (deal) com os seguintes dados:

name: mesmo nome do contato ou nÃºmero

stage: "prospecting" (primeiro estÃ¡gio do funil)

macrosetor: deve ser identificado com base no canal de origem:

Ex: WhatsApp Comercial â†’ comercial

WhatsApp Suporte â†’ suporte

WhatsApp CobranÃ§a â†’ cobranca

contactId: ID do novo contato

value: 0 (ou null)

tags: incluir ['lead_automÃ¡tico']

canal_origem: herdado do contato

created_at: timestamp atual

4. ğŸ”„ AssociaÃ§Ã£o com o funil correto
O negÃ³cio deve aparecer no funil correspondente ao macrosetor (comercial, suporte ou cobranÃ§a).

Exemplo: se o canal for â€œWhatsApp Suporteâ€, o negÃ³cio deve ser exibido automaticamente na primeira etapa do funil do suporte.

5. ğŸ§­ ExibiÃ§Ã£o imediata na interface
O negÃ³cio criado deve aparecer no Kanban (DealsKanban) no setor correto.

O contato deve aparecer na pÃ¡gina de contatos com o campo canal_origem e link para o negÃ³cio.

A conversa deve ser roteada para a caixa de entrada corretamente.

ğŸ“Œ Pergunta que vocÃª pode enviar ao Replit
Por favor, verifiquem se o seguinte fluxo estÃ¡ funcionando corretamente no sistema:

Quando uma nova mensagem chega por um canal (WhatsApp, Instagram, etc.), o sistema deve:

Criar automaticamente um novo contato (se nÃ£o existir);

Criar automaticamente um novo negÃ³cio no CRM;

Posicionar esse negÃ³cio no funil correto com base no canal (comercial, suporte ou cobranÃ§a);

Exibir esse negÃ³cio no Kanban, etapa â€œProspecÃ§Ã£oâ€ do setor correspondente;

Exibir o contato na listagem com canal de origem, tags e vÃ­nculo com o negÃ³cio.

Isso estÃ¡ implementado e funcionando como descrito? Caso nÃ£o, gostaria de entender onde estÃ¡ o ponto de falha.